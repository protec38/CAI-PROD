<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>üìã Gestion des √©v√®nements</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="csrf-token" content="{{ csrf_token() }}" />

<style>
  :root{
    --pc-blue:#003b71;
    --pc-orange:#f58220;
    --bg:#f6f8fc;
    --card:#ffffff;
    --line:#e6edf5;
    --ink:#0f172a;
    --muted:#667085;
    --radius:16px;
    --shadow:0 10px 24px rgba(16,24,40,.06);
  }

  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{
    font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, Noto Sans;
    color: var(--ink); background: var(--bg);
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }

  /* Header */
  .header{
    background: linear-gradient(180deg, var(--pc-blue), #002b52);
    color:#fff; text-align:center; padding:18px 12px;
    border-bottom: 4px solid var(--pc-orange);
  }
  .header .brand{
    display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap;
  }
  .logo{
    width:52px; height:52px; border-radius:14px; display:grid; place-items:center;
    background: linear-gradient(135deg, var(--pc-orange), #ff9f49); color:#112944; font-weight:900;
    box-shadow: inset 0 2px 10px rgba(0,0,0,.15);
  }
  .header h1{ margin:0; font-size: clamp(20px, 2.6vw, 28px); letter-spacing:.3px; }

  /* Container */
  .container{
    width: min(1000px, 94vw);
    margin: 24px auto 30px;
  }

  /* Card/table shell */
  .card{
    background: var(--card); border:1px solid var(--line); border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .card .hd{
    padding: 14px 16px; border-bottom:1px solid var(--line);
    background: linear-gradient(180deg,#fff,#f8fbff);
    color: var(--pc-blue); font-weight:900; letter-spacing:.2px;
  }
  .card .bd{ padding: 0; }

  /* Table */
  .table-wrap{ overflow-x:auto; }
  table{ width:100%; border-collapse: collapse; min-width:780px; }
  thead th{
    padding: 12px; text-align:left; color:#fff; font-weight:800; letter-spacing:.02em;
    background: var(--pc-blue);
  }
  tbody td{ padding:12px; border-top:1px solid #eef2f7; vertical-align: top; }
  tbody tr:nth-child(odd){ background:#fbfdff; }
  tbody tr:hover{ background:#f4f8ff; }

  /* Badges statut */
  .badge{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    font-weight:800; border:1px solid var(--line); background:#f3f6fb;
  }
  .b-open{ color:#0b6b3a; background:#e9f7ef; border-color:#cfeede; }
  .b-warn{ color:#8a6100; background:#fff6da; border-color:#ffe7ad; }
  .b-full{ color:#7a0916; background:#ffe8ec; border-color:#ffd1d9; }
  .b-setup{ color:#0b3d77; background:#eaf2ff; border-color:#d6e7ff; }
  .b-closed{ color:#374151; background:#f2f4f7; border-color:#e5e7eb; }

  /* Actions */
  .actions{ display:flex; gap:8px; flex-wrap:wrap; }
  .btn{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:10px; font-weight:800; text-decoration:none;
    border:1px solid #dbe6ff; background:#eef3ff; color:var(--pc-blue);
    cursor:pointer; transition: transform .04s ease, filter .15s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .btn.edit{ background:#fff8e1; border-color:#ffe7ad; color:#7f4a00; }
  .btn.del{ background:#ffe3e6; border-color:#ffcbd2; color:#9a1a2a; }

  /* Footer actions */
  .footer-actions{
    margin-top:16px; text-align:center;
  }
  .btn-back{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:12px; font-weight:900; text-decoration:none;
    border:1px solid #dbe6ff; background:#eef3ff; color:var(--pc-blue);
  }

  /* === Mobile portrait : garder la table compl√®te avec scroll horizontal === */
  @media (max-width: 680px){
    .table-wrap{
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
    }
    table{
      min-width: 960px; /* garder toutes les colonnes visibles via scroll */
    }
    th, td{
      white-space: nowrap;
    }
  }
</style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="brand">
      <div class="logo">PC</div>
      <h1>üìã Gestion des √©v√®nements</h1>
    </div>
  </header>

  <main class="container">

    <section class="card">
      <div class="hd">Liste des √©v√®nements</div>
      <div class="bd table-wrap">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Type</th>
              <th>Adresse</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for evt in evenements %}
            <tr>
              <td>{{ evt.id }}</td>
              <td>{{ evt.nom }}</td>
              <td>{{ evt.type_evt }}</td>
              <td>{{ evt.adresse }}</td>
              <td>
                {% set s = evt.statut or '' %}
                {% if s == 'Ouvert' %}
                  <span class="badge b-open">Ouvert</span>
                {% elif s == 'Effectif d√©pass√©' %}
                  <span class="badge b-warn">Effectif d√©pass√©</span>
                {% elif s == 'Complet' %}
                  <span class="badge b-full">Complet</span>
                {% elif s == 'Ferm√©' %}
                  <span class="badge b-closed">Ferm√©</span>
                {% else %}
                  <span class="badge b-setup">{{ s if s else '‚Äî' }}</span>
                {% endif %}
              </td>
              <td>
                {% if user.is_admin or user.role == "codep" or evt.createur_id == user.id %}
                  <div class="actions">
                    <a href="{{ url_for('main_bp.edit_evenement', evenement_id=evt.id) }}" class="btn edit">üìù Modifier</a>

                    <form method="POST" action="{{ url_for('main_bp.delete_evenement', evenement_id=evt.id) }}" onsubmit="return confirm('Supprimer cet √©v√®nement ?');" style="display:inline;">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                      <button type="submit" class="btn del">üóë Supprimer</button>
                    </form>
                  </div>
                {% else %}
                  <span style="color: gray;">üîí</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

    <div class="footer-actions">
      <a href="{{ url_for('main_bp.evenement_new') }}" class="btn-back">‚¨Ö Retour</a>
    </div>

  </main>

</body>
</html>
